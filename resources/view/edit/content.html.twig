{% macro getRepeatablePrototype(form, groupName, fields) %}
	{% filter escape %}
		<section class="group">
			{% for field in fields %}
			{{ form_row(form[groupName][field].vars.prototype) }}
			{% endfor %}
			<a href="#" data-group-remove class="button small remove">{{ 'ms.cms.repeatable_group.remove'|trans }}</a>
		</section>
	{% endfilter %}
{% endmacro %}

{% extends '::edit' %}

{% block form %}
	{% if content.count == 0 %}
		<p>{{ 'ms.cms.content.type.noContentAreas'|trans({'%pageType': page.type.displayName}) }}
	{% else %}
		{{ form_start(form) }}

			{# Loop through content parts #}
			{% for name, part in content %}

				{# If this part is not repeatable group #}
				{% if repeatables[name] is null %}
					{# If this part is a group, output the title & description, then each field in it #}
					{% if part.getFields is not null %}
					<section class="display-group">
						<h2 class="title">{{ ('page.' ~ page.type.getName ~ '.' ~ name ~ '.name')|trans }}</h2>
						<div class="content-wrap">
							<p class="group-desc">{{ ('page.' ~ page.type.getName ~ '.' ~ name ~ '.description')|trans }}</p>
							{% for field in part.getFields %}
							{{ form_row(form[name][field.getName]) }}
							{% endfor %}
						</div>

					</section>
					{# If this part is a normal field, just output it #}
					{% else %}
						{{ form_row(form[name]) }}
					{% endif %}

				{# If this content part is a repeatable group, output the title & description, then each group #}
				{% else %}
					<section class="display-group">
						<h2 class="title">{{ ('page.' ~ page.type.getName ~ '.' ~ name ~ '.name')|trans }}</h2>
						<div class="content-wrap">
							<p class="group-desc">{{ ('page.' ~ page.type.getName ~ '.' ~ name ~ '.description')|trans }}</p>
							<section class="repeatable-group">
								<div class="container">
									{% for i,group in part %}
										<section class="group" data-collapse data-identifier-field="{{ group.getIdentifierField().getName() }}">
											<h1 class="title">{{ group.getIdentifierField() }}</h1>
											<div class="content">
												{% for field in repeatables[name] %}
													{{ form_row(form[name][field][i]) }}
												{% endfor %}
												<a href="#" data-group-remove class="button small remove">{{ 'ms.cms.repeatable_group.remove'|trans }}</a>
											</div>
										</section>
									{% else %}
										{% do form[name].setRendered %}
									{% endfor %}
								</div>
								<div class="add-group">
									<a href="#" data-group-add data-prototype="{{ _self.getRepeatablePrototype(form, name, repeatables[name]) }}" data-group-index="{{ part.count }}" class="button small add">
											{{ 'ms.cms.repeatable_group.add'|transchoice(part.count, {'%name%': ('page.' ~ page.type.getName ~ '.' ~ name ~ '.singularName')|trans|lower}) }}
									</a>
								</div>
							</section>
						</div>
					</section>
				{% endif %}

			{% endfor %}

			<button type="submit" class="button small save" id="save-content">{{ 'ms.cms.content.button.save'|trans }}</button>

		{{ form_end(form)}}
	{% endif %}
{% endblock %}